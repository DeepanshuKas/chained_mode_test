apiVersion: v1
kind: Pod
metadata:
  {% if 'generate_name' in pod %}
  generateName: {{ pod['generate_name'] }}
  {% else %}
  name: {{ pod['name'] }}
  {% endif %}
  {% if 'labels' in pod %}
  labels:
    {% for k, v in pod['labels'].items() %}
    {{ k }}: {{ v }}
    {% endfor %}
  {% endif %}
  namespace: {{ pod.get('namespace', 'default') }}
spec:
  {% if 'node' in pod %}
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: kubernetes.io/hostname
            operator: In
            values:
            - {{ pod['node'] }}
  {% endif %}
  containers:
  - image: noiro-quay.cisco.com/noiro/nginx-non-root:un
    ports:
    - containerPort: 8080
    imagePullPolicy: IfNotPresent
    name: nginx-non-root
  restartPolicy: Always
  terminationGracePeriodSeconds: 0
  {% if 'host_network' in pod %}
  hostNetwork: {{ pod['host_network']}}
  {% endif %}
