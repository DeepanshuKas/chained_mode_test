apiVersion: aci.fabricattachment/v1
kind: NetworkFabricConfiguration
metadata:
  name: {{ input['name'] }}
  namespace: aci-containers-system
spec:
  {% if 'vlans' in input %}
  vlans:
  {% if 'epg_details' in input %}
  {% for epg_detail in input['epg_details'] %}
  - epg:
      bd:
        common-tenant: False
        name: {{ epg_detail['bd_name'] }}
        subnets: {{ epg_detail['subnets'] }}
        vrf:
          common-tenant: True
          name: {{ input['vrf_name'] }}
      contracts:
        consumer: {{ epg_detail['consumer_contract_name'] }}
        provider: {{ epg_detail['provider_contract_name'] }}
      discoveryType: LLDP
      name: {{ epg_detail['epg_name'] }}
      tenant: {{ input['tenant_name'] }}
    vlans: "{{ epg_detail['vlans'] }}"
  {% endfor %}
  {% else %}
  - vlans: "{{ input['vlans'] }}"
    aeps:
    - {{ input['aeps'] }}
  {% endif %}
  {% else %}
  nadVlanRefs:
  - nadVlanLabel: {{ input['nadvlanlabel'] }}
    aeps:
    - {{ input['aeps'] }}
  {% endif %}
